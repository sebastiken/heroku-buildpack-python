set +e

puts-step "Step buildout"
if [ -f buildout.cfg ]; then
    puts-step "Found buildout.cfg, running buildout"

    puts-step "Read BOOTSTRAP_PY_URL from env vars, or use default"
    if [ -z $BOOTSTRAP_PY_URL ]; then
        export "BOOTSTRAP_PY_URL=http://downloads.buildout.org/2/bootstrap.py"
        puts-step "Use default bootstrap.py: ${BOOTSTRAP_PY_URL}"
    else
        puts-step "Use custom bootstrap.py: ${BOOTSTRAP_PY_URL}"
    fi

    puts-step "Read BUILDOUT_CFG from env vars, or use default"
    if [ -z $BUILDOUT_CFG ]; then
        export "BUILDOUT_CFG=buildout.cfg"
        puts-step "Using default: buildout.cfg"
    else
        puts-step "Found ${BUILDOUT_CFG}"
    fi

    puts-step "Read BUILDOUT_VERBOSITY from env vars, or use default"
    if [ -z $BUILDOUT_VERBOSITY ]; then
        export "BUILDOUT_VERBOSITY="
        puts-step "Use default buildout verbosity"
    else
        puts-step "Use verbosity: ${BUILDOUT_VERBOSITY}"
    fi

    puts-step "Init buildout"
    curl -OL "${BOOTSTRAP_PY_URL}"
    python bootstrap.py -c $BUILDOUT_CFG
    puts-step "Run bin/buildout -c ${BUILDOUT_CFG} ${BUILDOUT_VERBOSITY}"
    bin/buildout -c $BUILDOUT_CFG $BUILDOUT_VERBOSITY

fi
